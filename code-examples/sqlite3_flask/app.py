#!/usr/bin/env python
import sqlite3
from flask import Flask
from flask import request

app = Flask(__name__)
ret =""

@app.route('/')
def hello_world():
    return "Hello World\n"

@app.route('/getall')
def get_all():
    global ret
    ret =""
    con = sqlite3.connect("company.db")
    curser = con.cursor()
    
    curser.execute("SELECT * from employee")
    ret+= "fetchall:\n"
    result = curser.fetchall()
    for r in result:
        ret += str(r)
        ret += "\n"
    return ret

@app.route('/add', methods=['POST'])
def add():
    global ret
    ret =""
    print request.form

    fname = request.form['fname']
    lname = request.form['lname']
    gender = request.form['gender']
    birth = request.form['birth']

    connection = sqlite3.connect("company.db")
    cursor = connection.cursor()
    
    format_str = """INSERT INTO employee (staff_number, fname, lname, gender, birth_date)
    VALUES (NULL, "{first}", "{last}", "{gender}", "{birthdate}");"""
    sql_command = format_str.format(first=fname, last=lname, gender=gender, birthdate = birth)
    print sql_command 
    cursor.execute(sql_command)
    connection.commit()
    
    ret += "Sucessfully inserted " + fname + "\n"
    return ret

if __name__ == "__main__":
    app.run(host='0.0.0.0', port=80, debug=True)





